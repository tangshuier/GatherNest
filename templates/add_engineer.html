{% extends 'base.html' %}

{% block title %}成品管理系统{% endblock %}
{% block page_title %}添加员工账户{% endblock %}

{% block content %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const roleLevelSelect = document.getElementById('role_level');
        const roleDetailDiv = document.getElementById('role_detail_div');
        const roleDetailSelect = document.getElementById('role_detail');
        
        // 初始化显示状态
        updateRoleDetailVisibility();
        
        // 监听角色级别变化
        roleLevelSelect.addEventListener('change', updateRoleDetailVisibility);
        
        function updateRoleDetailVisibility() {
            if (roleLevelSelect.value == '3') {
                // 正式员工，显示详细角色选择
                roleDetailDiv.style.display = 'block';
                roleDetailSelect.setAttribute('required', 'required');
            } else {
                // 试岗员工，隐藏详细角色选择
                roleDetailDiv.style.display = 'none';
                roleDetailSelect.removeAttribute('required');
            }
        }
    });
</script>
<form method="POST" action="/admin/add_engineer">
    {{ form.hidden_tag() }}
    <div class="form-group">
        <label>员工姓名:</label>
        {{ form.name(class='form-control') }}
        {% for error in form.name.errors %}
            <span class="text-danger">{{ error }}</span>
        {% endfor %}
    </div>
    <div class="form-group">
        <label>用户名:</label>
        {{ form.username(class='form-control') }}
        {% for error in form.username.errors %}
            <span class="text-danger">{{ error }}</span>
        {% endfor %}
        <small>用户名只能包含字母和数字</small>
    </div>
    <div class="form-group">
        <label>密码:</label>
        {{ form.password(class='form-control') }}
        {% for error in form.password.errors %}
            <span class="text-danger">{{ error }}</span>
        {% endfor %}
        <small>密码长度不能少于8位</small>
    </div>
    <div class="form-group">
        <label>确认密码:</label>
        {{ form.confirm_password(class='form-control') }}
        {% for error in form.confirm_password.errors %}
            <span class="text-danger">{{ error }}</span>
        {% endfor %}
    </div>
    <div class="form-group">
        <label>角色级别:</label>
        {{ form.role_level(class='form-control') }}
        {% for error in form.role_level.errors %}
            <span class="text-danger">{{ error }}</span>
        {% endfor %}
    </div>
    <div class="form-group" id="role_detail_div">
        <label>详细角色 (正式员工选择):</label>
        {{ form.role_detail(class='form-control') }}
        {% for error in form.role_detail.errors %}
            <span class="text-danger">{{ error }}</span>
        {% endfor %}
    </div>
    <div style="text-align: center; margin-top: 1.5rem;">
        {{ form.submit(class='btn-primary') }}
        <a href="/admin/users">
            <button type="button" class="btn-secondary">返回</button>
        </a>
    </div>
</form>
{% endblock %}
